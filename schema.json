{
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "$id": "https://raw.githubusercontent.com/MrPeacockNLB/schema/main/schema.json",
    "title": "Coder.yaml",
    "description": "Description of a coder.yaml",
    "type": "object",
    "properties": {
        "coder": {
            "type": "object",
            "properties": {
                "workspace": {
                    "type": "object",
                    "description": "Settings for workspace",
                    "properties": {
                        "env": {
                            "description": "Array of Environment vars",
                            "type": "array",
                            "items": {
                                "type": "object",
                                "description": "Must contain name as Environment var name and value as value for this var",
                                "properties": {
                                    "name": {
                                        "type": "string",
                                        "description": "Name of the Environment var"
                                    },
                                    "value": {
                                        "type": "string",
                                        "description": "actual value of the Environment var"
                                    }
                                },
                                "additionalProperties": false,
                                "required": [
                                    "name",
                                    "value"
                                ]
                            }
                        },
                        "requests": {
                            "description": "Kubernetes requests on CPU and Memory",
                            "type": "object",
                            "properties": {
                                "cpu": {
                                    "type": "integer",
                                    "description": "How much cpu does this workspace need to be deployed"
                                },
                                "memory": {
                                    "type": "integer",
                                    "description": "How much memory does this workspace need to be deployed"
                                }
                            },
                            "additionalProperties": false
                        },
                        "limits": {
                            "description": "Kubernetes limits on CPU and Memory",
                            "type": "object",
                            "properties": {
                                "cpu": {
                                    "type": "integer",
                                    "description": "This defines the maximum memory to be allocated by this workspace"
                                },
                                "memory": {
                                    "type": "integer",
                                    "description": "This defines the maximum memory to be allocated by this workspace"
                                }
                            },
                            "additionalProperties": false
                        },
                        "image": {
                                "type": "string",
                                "description": ""
                        },
                        "init_script_timeout": {
                            "type": "integer",
                            "description": ""
                        },
                        "git": {
                            "description": "Kubernetes requests on CPU and Memory",
                            "type": "object",
                            "properties": {
                                "enable_precommit": {
                                    "type": "boolean",
                                    "description": "If this is true then pre-commit get automatically enabled on cloned repositories"
                                },
                                "merge_strategy": {
                                    "type": "string",
                                    "description": "rebase or merge",
                                    "enum": [
                                        "rebase",
                                        "merge"
                                    ]
                                },
                                "additional_repos": {
                                    "description": "Array of additional repository be be cloned into the workspace",
                                    "type": "array",
                                    "items": {
                                        "type": "object",
                                        "description": "Must contain name as Environment var name and value as value for this var",
                                        "properties": {
                                            "description": {
                                                "type": "string",
                                                "description": "Description of usage for this repository. Optional"
                                            },
                                            "git_orga": {
                                                "type": "string",
                                                "description": "This is the GitHub organisation of the repo to be cloned"
                                            },
                                            "git_repo": {
                                                "type": "string",
                                                "description": "This is the repository name of the repo to be cloned"
                                            },
                                            "git_ref": {
                                                "type": "string",
                                                "description": "This is the branch to be checked out. Defaults to main"
                                            }
                                        },
                                        "additionalProperties": false,
                                        "required": [
                                            "git_orga",
                                            "git_repo",
                                            "git_ref"
                                        ]
                                    }
                                }
                            },
                            "additionalProperties": false
                        },
                        "additionalProperties": false
                    },
                    "additionalProperties": false 
                },
                "vscode": {
                    "type": "object",
                    "description": "Settings for code-server a.k.a. VSCode online",
                    "properties": {
                        "enable": {
                            "type": "boolean",
                            "description": "true enables the installation of VSCoder server"
                        },
                        "extensions": {
                            "description": "VSCode extensions",
                            "type": "array",
                            "items": {
                                "type": "object",
                                "description": "Array of unique extension id's",
                                "properties": {
                                    "id": {
                                        "type": "string",
                                        "description": "Name (unique id) of VSCode extension to be loaded at VSCode startup. E.g.: hashicorp.terraform"
                                    }
                                },
                                "additionalProperties": false,
                                "required": [
                                    "id"
                                ]
                            }
                        },
                        "install_vsix": {
                            "type": "boolean",
                            "description": "true enables the installation of all in /workspace found extensions"
                        }
                    },
                    "additionalProperties": false
                },
                "jobs": {
                    "description": "array of jobs",
                    "type": "array",
                    "items": {
                        "type": "object",
                        "description": "",
                        "properties": {
                            "name": {
                                "type": "string",
                                "description": "Name of job to be executed within init phase of the workspace"
                            },
                            "cmd": {
                                "type": "string",
                                "description": "Actual job to be executed within init phase of the workspace"
                            },
                            "description": {
                                "type": "string",
                                "description": "Description of job to be executed within init phase of the workspace"
                            }
                        },
                        "additionalProperties": false,
                        "required": [
                        "name",
                        "cmd"
                        ]
                    }
                },
                "apps": {
                    "type": "array",
                    "description": "Use this resource to define shortcuts to access applications in a workspace.",
                    "items": {
                        "type": "object",
                        "properties": {
                            "display_name": {
                                "type": "string",
                                "description": "Displayname (human readable) of the application"
                            },
                            "slug": {
                                "type": "string",
                                "description": "(String) A hostname-friendly name for the app. This is used in URLs to access the app. May contain alphanumerics and hyphens. Cannot start/end with a hyphen or contain two consecutive hyphens."
                            },
                            "url": {
                                "type": "string",
                                "description": ""
                            },
                            "icon": {
                                "type": "string",
                                "description": "TODO"
                            },
                            "subdomain": {
                                "type": "boolean",
                                "description": "(Boolean) Determines whether the app will be accessed via it's own subdomain or whether it will be accessed via a path on Coder. If wildcards have not been setup by the administrator then apps with \"subdomain\" set to true will not be accessible. Defaults to false."
                            },
                            "share": {
                                "type": "string",
                                "description": "Determines the \"level\" which the application is shared at. Valid levels are \"owner\" (default), \"authenticated\" and \"public\". Level \"owner\" disables sharing on the app, so only the workspace owner can access it. Level \"authenticated\" shares the app with all authenticated users. Level \"public\" shares it with any user, including unauthenticated users."
                            },
                            "healthcheck": {
                                "type": "object",
                                "description": "(Block Set, Max: 1) HTTP health checking to determine the application readiness.",
                                "properties": {
                                    "url": {
                                        "type": "string",
                                        "description": "(String) HTTP address used determine the application readiness. A successful health check is a HTTP response code less than 500 returned before healthcheck.interval seconds."
                                    },
                                    "interval": {
                                        "type": "integer",
                                        "description": "(Number) Duration in seconds to wait between healthcheck requests. If unsure set to 3"
                                    },
                                    "threshold": {
                                        "type": "integer",
                                        "description": "(Number) Number of consecutive heathcheck failures before returning an unhealthy status. If unsure set to 10"
                                    }
                                },
                                "required": [
                                    "url",
                                    "interval",
                                    "threshold"
                                ]
                            }
                        },
                        "required": [
                            "display_name",
                            "slug",
                            "icon",
                            "url",
                            "subdomain",
                            "share",
                            "healthcheck"
                        ]
                    }
                }
            }
        } 
    },
    "additionalProperties": false,
    "required": [
        "coder"
    ]  
}
